
    <!DOCTYPE html>
    <html lang="en">
    <head profile="http://www.w3.org/2005/10/profile">
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Firestore Sub-Collections</title>
      <link rel="icon" type="image/png" href="/static/images/logos/chrisesplin-logo.png">
      <link rel="stylesheet" href="https://use.typekit.net/ytf5tsl.css">
      <link rel="stylesheet" href="/static/css/base.css"/>
      <link rel="stylesheet" href="/static/css/project.shortcode.css"/>

      <script async src="https://www.googletagmanager.com/gtag/js?id=UA-6859198-21"></script>
      <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-6859198-21');
      </script>
    </head>
    <body>
      <header>
        <a href="/">
          <h1>chris esplin</h1>
        </a>
      </header>

      <div id="content">
      <style>
        .page {
          width: 800px;
          max-width: calc(100vw - 2em);
        }

        .page p {
          margin-bottom: 2em;
        }
      </style>
      <div class="page">
      <style>
        .writing {
          width: 800px;
          max-width: calc(100vw - 2em);
        }

        .writing p {
          margin-bottom: 2em;
        }
      </style>
      <div class="writing">
      <style>
        .medium .title {
          display: flex;
          justify-content: space-between;
          margin-bottom: 1em;
          font-size: 1.5em;
        }
        
        .medium .subtitle {
          margin-bottom: 2em;
        }

        .medium .date {
          /* font-size: 0.5em; */
        }

        .medium hr {
          margin-top: 1em;
        }

        .medium img ~ em {
          display: block;
          font-size: 0.75em;
          text-align: center;
          width: 100%;
        }
      </style>
      <div class="medium">
        <hr/>
        
        <div class="title">
          <span class="text-headline">Firestore Sub-Collections</span>
        </div>
        <div class="subtitle text-bold">If you‚Äôve been keeping up on Firebase in the last year then you‚Äôre likely using Firestore.</div>

        <span class="date">2018/07/02</span>
        
        <hr/>

        <div className="medium-content">
          <p>Firestore is a bit of a successor to the original Firebase Realtime Database.</p>
<p>After Google purchased Firebase in October of 2014 Firebase had to move over to Google infrastructure. That‚Äôs a ton of work, but once you‚Äôre on Google infrastructure, <em>you‚Äôre on Google infrastructure</em>!</p>
<p>So you might as well design a new database from scratch that crushes everything that came before üòç</p>
<p>And that‚Äôs how we got Firestore.</p>
<p>I‚Äôve talked about Firestore in the past, so review those <a href="https://www.youtube.com/channel/UCaAByidxypZTYOj4OsKzD2Q">videos </a>and <a href="https://howtofirebase.com/">articles</a>, or check out <a href="https://www.fullstackfirebase.com/">FullStackFirebase.com</a> for the Firestore introduction.</p>
<p>I‚Äôd like to talk at a high level about Firestore sub-collections.</p>
<p>First, we need to review the Firestore data model. Firestore is a document/collection database. Documents hold whatever JSON data you‚Äôd like, but they must live within a collection.</p>
<p>A document can have any number of sub-collections with their own documents. And you can keep nesting your data within sub-collections to your heart‚Äôs content.</p>
<p>But that would be a horrible mistake.</p>
<p>In fact, I haven‚Äôt found a great use case for sub-collections quite yet. First off, you can easily save embedded JSON objects within your documents, so it‚Äôs not necessary to make a sub-collection to nest data within a document.</p>
<p>And second, sub-collections are easily orphaned.</p>
<p>What do I mean by orphaned???</p>
<p>I mean that if you delete a document‚Äôs data without deleting it‚Äôs sub-collections, you can no longer query the document, so you might lose your reference to it, and lose track of its sub-collections.</p>
<p>This deserves some extra explanation.</p>
<p>If I have a collection called <strong>foods</strong>, I can query all of the documents in my <strong>foods</strong> collection. Imagine that I have a <strong>food</strong> document named <strong>gelato</strong>. My <strong>gelato</strong> document has attributes for <strong>color</strong>, <strong>calories</strong> and <strong>deliciousnessRating</strong>.</p>
<p>I want to track the ingredients in my gelato, so I create an <strong>ingredients</strong> sub-collection. When I query my <strong>foods</strong> I get an object back named <strong>gelato</strong> with <strong>color</strong>, <strong>calories</strong> and <strong>deliciousnessRating</strong> attributes.</p>
<p>But I don‚Äôt get the <strong>ingredients</strong> sub-collection.</p>
<p>I only get the <strong>ingredients</strong> sub-collection if I make a separate query for it.</p>
<p>And I have to just know that it‚Äôs there. There‚Äôs no hint that my <strong>gelato</strong> document has sub-collections. So I can lose track of my <strong>ingredients</strong> sub-collection by forgetting that it exists.</p>
<p>Now imagine that I delete my gelato document for some reason.</p>
<p>My <strong>gelato</strong> document is gone, but I‚Äôve forgotten to delete my <strong>ingredients</strong> sub-collection. Because, get this‚Ä¶ I have to manually delete a document‚Äôs sub-collections.</p>
<p>And to add insult to injury, since I deleted the <strong>gelato</strong> document, it no longer shows up in my <strong>foods</strong> queries. So now I don‚Äôt know that <strong>gelato</strong> ever existed, but the <strong>ingredients</strong> sub-collection is still there.</p>
<p>You can see these orphaned sub-collections by clicking through the Firestore web console. But you have to click through every single document to find them, because orphaned sub-collections don‚Äôt show up when you query their parents.</p>
<p>This is garbage.</p>
<p>I‚Äôm confident that the Firebase team knows of this problem and has some plan to address it, because Firestore is still in beta of course, and I‚Äôm thankful to have Firestore even with it‚Äôs wacky sub-collection system.</p>
<p>Just don‚Äôt get suckered by sub-collections.</p>
<p>They have their uses for sure. I‚Äôve used them to cascade security rules and it‚Äôs been great, but sub-collections are still iffy as a cornerstone of your data model.</p>
<p>The good news is that you don‚Äôt need sub-collections to build your app on Firestore.</p>
<p>And they‚Äôll likely get more useful in time, so I‚Äôm hopeful.</p>
<p>Let me know what you think about Firestore in the comments.</p>
<p>I‚Äôll hang out and answer questions as always.</p>
<p>And don‚Äôt forget to follow this publication for more Firebase tips and tricks ‚ú®üéâüî•</p>
  
        </div>
      </div>
    </div>
    </div>
    </div>

      <footer>
        <ul>
          <li>
            <a href="/resume">Resume</a>
          </li>
          <li>
            <a href="/projects">Projects</a>
          </li>
          <li>
            <a href="/writing">Writing</a>
          </li>
          <li>
            <a href="mailto:chris@christopheresplin.com?subject=ChrisEsplin.com%20inquiry&body=Hey%20Chris!%0A%0AI%20found%20you%20on%20ChrisEsplin.com%20and%20thought%20we%20might%20be%20able%20to%20work%20together.%0A%0A...">Email</a>
          </li>
          <li>
            <a href="https://twitter.com/chrisesplin">Twitter</a>
          </li>
          <li>
            <a href="https://www.youtube.com/c/ChrisEsplin">YouTube</a>
          </li>
          <li>
            <a href="https://github.com/deltaepsilon">GitHub</a>
          </li>
          <li>
            <a href="https://www.linkedin.com/in/epsilon/">LinkedIn</a>
          </li>
        </ul>
      </footer>
    </body>
    </html>
  